<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Masonite Admin</title>
  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.0/react-router-dom.min.js"></script>
</head>

<body>
  <div id='app'></div>
  <script type="text/babel">
    const BrowserRouter = window.ReactRouterDOM.BrowserRouter
    const Route = window.ReactRouterDOM.Route;
    const Link = window.ReactRouterDOM.Link;
    const Switch = window.ReactRouterDOM.Switch;
    const browserHistory = window.ReactRouterDOM.browserHistory;

    class App extends React.Component{
      render(){
        return(
          <BrowserRouter history={browserHistory} >
            <Switch>
              <Route exact path='/admin' component={Root}/>
              <Route path='/admin/:table' component={List}/>
            </Switch>
          </BrowserRouter>
        );
      }
    }

    class Root extends React.Component {
      render(){
        return(
          <h1>Masonite Admin</h1>
        );
      }
    }

    class List extends React.Component{
      constructor(props){
        super(props);
        this.state = {
            multi: [],
        }
        this.multi = this.multi.bind(this);
      }

      multi(table){
        const self = this;
        axios.get('/admin/api/'+table)
        .then(function(response){
          self.setState({multi: response.data});
        })
      }

      componentDidMount(){
        const table = this.props.match.params.table;
        this.multi(table);
      }

      render(){;
        let html_headers = [];
        let multi = [];

        if(this.state.multi[0]){
          let headers = Object.keys(this.state.multi[0]);

          for(let header of headers){
            html_headers.push(<th>{header}</th>);
          }

          for(let row of this.state.multi){
            let row_html = [];
            for(let key in row){
              row_html.push(<td>{row[key]}</td>)
            }

            multi.push(<tr>{row_html}</tr>);
          }
        }

        return(
          <table>
            <thead>
              <tr>{html_headers}</tr>
            </thead>
            <tbody>
              {multi}
            </tbody>
          </table>
        );
      }
    }

    ReactDOM.render(<App />, document.getElementById('app'));
  </script>
</body>

</html>